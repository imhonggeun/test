<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://avatars.githubusercontent.com/u/20333260?v=4" rel="icon" type="image/x-icon">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<title>Insert title here</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script>
$(()=>{
	const ctx = document.getElementById('myChart').getContext('2d');

    // 차트 객체 먼저 생성 (데이터는 빈 값)
    const myChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['전체 회원'],
            datasets: [{
                label: '회원',
                data: [0],   // 초기값
                backgroundColor: 'rgba(75, 192, 192, 0.6)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false, 
            plugins: {
                legend: { position: 'bottom' } 
              },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        stepSize: 1
                    }
                }
            }
        }
    });

    // AJAX 요청 (회원 수 가져오기) loadUserCount
    $(()=>{
        $.ajax({
            url: "/role-user/total",  // Controller API
            type: "GET",
            success: function(response) {
                const count = response.totalUserCount;

                // 텍스트 갱신
                $("#userCountArea").html("<p>전체 회원 수 : " + count + "명</p>");

                // 차트 데이터 갱신
                myChart.data.datasets[0].data[0] = count;
                myChart.update();
            },
            error: function(xhr, status, error) {
                console.error("에러 발생:", error);
            }
        });
    })
/*     function loadUserCount() {
        $.ajax({
            url: "/role-user/total",  // Controller API
            type: "GET",
            success: function(response) {
                const count = response.totalUserCount;

                // 텍스트 갱신
                $("#userCountArea").html("<p>전체 회원 수 : " + count + "명</p>");

                // 차트 데이터 갱신
                myChart.data.datasets[0].data[0] = count;
                myChart.update();
            },
            error: function(xhr, status, error) {
                console.error("에러 발생:", error);
            }
        });
    } */
    // ==== 파일 수 pie 차트 ====
    const fileCtx = document.getElementById('fileChart').getContext('2d');
    const fileChart = new Chart(fileCtx, {
      type: 'pie',
      data: {
        labels: ['파일 갯수'],
        datasets: [{
          label: '파일 수',
          data: [0],
          backgroundColor: ['rgba(255, 99, 132, 0.6)'],
          borderColor: ['rgba(255, 99, 132, 1)'],
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: 'bottom' }
        }
      }
    });
    
    
    //파일
    $(()=>{
    	$.ajax({
    		url: "/file/total",
    		type: "GET",
    		success: function(response){
    			const count = response.fileTotal;
    			$("#fileCountArea").html("<p>전체 파일 갯수 : "+ count + "개</p>")
    			fileChart.data.labels = ['파일'];
    	        fileChart.data.datasets[0].data = [count];
    	        fileChart.update();
    		},
    		
    		
    	})
    })
	
    
    
    // 최초 1회 실행
    //loadUserCount();

    // 5초마다 실시간 업데이트
    //setInterval(loadUserCount, 5000);
})

</script>
</head>
<body>
<div>
    <h2>gate way view</h2>
    <div id="userCountArea"></div>
    <div style="width:200px; height:200px;">
        <canvas id="myChart" ></canvas>
    </div>
    
    <div id="fileCountArea"></div>
    <div style="width:200px; height:200px;">
    	<canvas id="fileChart"></canvas>
    </div>
</div>
</body>
</html>
